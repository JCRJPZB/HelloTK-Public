{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/Heros/Formation/HeroPortrait.ts"],"names":["_decorator","Component","Label","Sprite","ImgMgr","Subscribe","ccclass","property","HeroPortrait","onLoad","unselected","node","getChildByName","selected","select_trigger","portrait","getComponent","name_lbl","lv_lbl","sp_trigger","sp_disable","sp_enable","init","conf","id","is_select","active","on","trigger","changeSelected","bind","string","is_sp","changeSphero","spriteFrame","getInstance","getImg"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label, Sprite } from 'cc';\r\nimport { ImgMgr } from '../../Tools/ImgMgr';\r\nimport { Subscribe } from '../../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroPortrait')\r\nexport class HeroPortrait extends Component {\r\n\r\n    private id: string = \"\"; // 当前武将id\r\n    private unselected: Node | null = null; // 未被选中时的边框节点\r\n    private selected: Node | null = null; // 被选中时的边框节点\r\n    private select_trigger: Node | null = null; // 选中触发器\r\n    private is_select: boolean = false; // 是否被编队选中标志\r\n    private portrait: Sprite | null | undefined = null; // 武将头像精灵组件\r\n    private name_lbl: Label | null | undefined = null; // 武将名称Label\r\n    private lv_lbl: Label | null | undefined = null; // 武将等级Label\r\n    private sp_trigger: Node | null = null; // 设为/取消常用触发器\r\n    private sp_disable: Node | null | undefined = null; // 非常用\r\n    private sp_enable: Node | null | undefined = null; // 常用\r\n    private is_sp: boolean = false; // 是否是常用标志\r\n\r\n    onLoad() { // 获取组件、节点\r\n        this.unselected = this.node.getChildByName(\"Border_unselected\");\r\n        this.selected = this.node.getChildByName(\"Border_selected\");\r\n        this.select_trigger = this.node.getChildByName(\"Select_trigger\");\r\n        this.portrait = this.node.getChildByName(\"Portrait\")?.getComponent(Sprite);\r\n        this.name_lbl = this.node.getChildByName(\"Name\")?.getComponent(Label);\r\n        this.lv_lbl = this.node.getChildByName(\"Lv_Label\")?.getComponent(Label);\r\n        this.sp_trigger = this.node.getChildByName(\"Sp_trigger\");\r\n        this.sp_disable = this.sp_trigger?.getChildByName(\"Sp_disable\");\r\n        this.sp_enable = this.sp_trigger?.getChildByName(\"Sp_enable\");\r\n    }\r\n\r\n    init(conf: any) {\r\n        this.id = conf[\"id\"]; // 设置id\r\n        this.is_select = conf[\"is_select\"]; // 获取被编队选中状态\r\n        if (this.selected && this.unselected) { this.selected.active = this.is_select; this.unselected.active = !this.is_select; }\r\n        if (this.select_trigger) {\r\n            this.select_trigger.on(\"click\", () => { // 触发选中，发射选中消息\r\n                Subscribe.trigger(\"change hero selected\", this.id, this.is_select, this.changeSelected.bind(this));\r\n            });\r\n        }\r\n\r\n        if (this.name_lbl) { this.name_lbl.string = conf[\"name\"]; } // 显示武将名称\r\n        if (this.lv_lbl) { this.lv_lbl.string = \"Lv.\" + conf[\"level\"]; } // 显示武将等级\r\n        this.is_sp = conf[\"is_sp\"]; // 设置常用状态\r\n        if (this.sp_disable && this.sp_enable && this.sp_trigger) {\r\n            this.sp_trigger.on(\"click\", this.changeSphero, this); // 触发取消/设为常用，发射消息\r\n            this.sp_disable.active = !this.is_sp; // 修改常用标记\r\n            this.sp_enable.active = this.is_sp;\r\n        }\r\n        if (this.portrait) this.portrait.spriteFrame = ImgMgr.getInstance().getImg(conf[\"hero_id\"]); // 显示武将头像\r\n    }\r\n\r\n    changeSelected() { // 修改被编队选中的状态\r\n        if (this.selected && this.unselected) {\r\n            this.is_select = !this.is_select;\r\n            this.selected.active = this.is_select;\r\n            this.unselected.active = !this.is_select;\r\n        }\r\n    }\r\n\r\n    changeSphero() { // 修改常用状态\r\n        if (this.sp_disable && this.sp_enable) {\r\n            this.is_sp = !this.is_sp;\r\n            this.sp_disable.active = !this.is_sp;\r\n            this.sp_enable.active = this.is_sp;\r\n            Subscribe.trigger(\"changeSpHero\", this.id, this.is_sp);\r\n        }\r\n    }\r\n}\r\n"]}