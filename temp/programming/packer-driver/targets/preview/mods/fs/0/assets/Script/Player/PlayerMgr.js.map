{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/Player/PlayerMgr.ts"],"names":["_decorator","Component","Subscribe","ccclass","property","PlayerMgr","constructor","name","Map","player_info","getPlayer","player_list","getPlayerList","forEach","player","player_map","set","getInstance","ist","getPlayerAllInfo","getPlayerInfo","info_id","getPlayerAllInfoById","pid","has","get","getPlayerInfoById","info","leaveLeague","trigger","updateInfo","joinLeague","league_id","test_data_player_list","test_data_player_info"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { Subscribe } from '../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PlayerMgr')\r\nexport class PlayerMgr extends Component {\r\n\r\n    private static ist: PlayerMgr;\r\n\r\n    private player_info: any = null;\r\n    private player_list: any = [];\r\n    private player_map: Map<string, any> = new Map();\r\n\r\n    // #############################################\r\n    private test_data_player_info: any = {\r\n        \"pid\": \"22389299\",\r\n        \"pname\": \"紫冰\",\r\n        \"league_id\": null, //\"1000001\",\r\n        \"items\": [\"10001\", \"10002\", \"10003\"]\r\n    };\r\n\r\n    private test_data_player_list: any = [\r\n        {\r\n            \"pid\": \"22389299\",\r\n            \"pname\": \"紫冰\",\r\n            \"league_id\": \"1000001\",\r\n            \"items\": [\"10001\", \"10002\", \"10003\"]\r\n        },\r\n        {\r\n            \"pid\": \"36279225\",\r\n            \"pname\": \"测试账号\",\r\n            \"league_id\": null,\r\n            \"items\": []\r\n        },\r\n        {\r\n            \"pid\": \"10000001\",\r\n            \"pname\": \"《HelloTK》官方\",\r\n            \"league_id\": \"1000001\",\r\n            \"items\": []\r\n        }\r\n    ]\r\n    // #############################################\r\n\r\n    private constructor(name: string) {\r\n        super(name);\r\n        this.player_info = this.getPlayer();\r\n        this.player_list = this.getPlayerList();\r\n        this.player_list.forEach((player: any) => { this.player_map.set(player[\"pid\"], player); });\r\n    }\r\n\r\n    public static getInstance() {\r\n        if (!PlayerMgr.ist) { PlayerMgr.ist = new PlayerMgr(\"PlayerMgr\"); }\r\n        return PlayerMgr.ist;\r\n    }\r\n\r\n    public getPlayerAllInfo() {\r\n        return this.player_info;\r\n    }\r\n\r\n    public getPlayerInfo(info_id: string) {\r\n        return this.player_info[info_id];\r\n    }\r\n\r\n    public getPlayerAllInfoById(pid: string) {\r\n        if (!this.player_map.has(pid)) { return null; }\r\n        return this.player_map.get(pid);\r\n    }\r\n\r\n    public getPlayerInfoById(pid: string, info: string) {\r\n        if (!this.player_map.has(pid)) { return null; }\r\n        return this.player_map.get(pid)[info];\r\n    }\r\n\r\n    public leaveLeague() {\r\n        if (!this.player_info[\"league_id\"]) {\r\n            return;\r\n        }\r\n        Subscribe.trigger(\"player leave league\", this.player_info[\"league_id\"], this.player_info[\"pid\"]);\r\n        this.player_info[\"league_id\"] = null;\r\n        this.updateInfo();\r\n    }\r\n\r\n    public joinLeague(league_id: string) {\r\n        if (this.player_info[\"league_id\"]) {\r\n            Subscribe.trigger(\"log err\", \"已加入其它联盟!\");\r\n            return;\r\n        }\r\n        this.player_info[\"league_id\"] = league_id;\r\n        this.updateInfo();\r\n        Subscribe.trigger(\"player join league\", league_id, this.player_info[\"pid\"]);\r\n    }\r\n\r\n    private updateInfo() {\r\n        // #########################\r\n        //     上传更新玩家信息     #\r\n        // #########################\r\n    }\r\n\r\n    private getPlayerList() {\r\n        // ####################################\r\n        return this.test_data_player_list; // #\r\n        // ####################################\r\n    }\r\n\r\n    private getPlayer() {\r\n        // ####################################\r\n        return this.test_data_player_info; // #\r\n        // ####################################\r\n    }\r\n}\r\n"]}