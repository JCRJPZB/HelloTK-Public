{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/Items/ItemMgr.ts"],"names":["_decorator","Component","Configure","Generator","ImgMgr","Subscribe","Item","ccclass","property","ItemMgr","constructor","name","Map","conf","getConfigure","item_types","forEach","item","conf_map","set","imgMgr","getInstance","gen","listen","tryUseItem","ist","getItemTypes","getItemConf","id","has","get","getItemNode","parent","item_num","browser_root","pos","node","generator","trigger","ctrl","getComponent","init","num","item_browser_root","callback"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AACZC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,I,iBAAAA,I;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;yBAGjBS,O,WADZF,OAAO,CAAC,SAAD,C,mCAAR,MACaE,OADb,SAC6BR,SAD7B,CACuC;AAS3BS,QAAAA,WAAW,CAACC,IAAD,EAAe;AAC9B,gBAAMA,IAAN;;AAD8B;;AAAA,8CALN,EAKM;;AAAA,4CAJG,IAAIC,GAAJ,EAIH;;AAAA,0CAHF,IAGE;;AAAA,uCAFF,IAEE;;AAE9B,eAAKC,IAAL,GAAY;AAAA;AAAA,sCAAUC,YAAV,CAAuB,OAAvB,CAAZ;;AACA,cAAI,KAAKD,IAAT,EAAe;AACX,iBAAKE,UAAL,GAAkB,KAAKF,IAAL,CAAU,OAAV,CAAlB;AACA,iBAAKA,IAAL,CAAU,OAAV,EAAmBG,OAAnB,CAA4BC,IAAD,IAAe;AACtC,mBAAKC,QAAL,CAAcC,GAAd,CAAkBF,IAAI,CAAC,IAAD,CAAtB,EAA8BA,IAA9B;AACH,aAFD;AAGH;;AACD,eAAKG,MAAL,GAAc;AAAA;AAAA,gCAAOC,WAAP,EAAd;AACA,eAAKC,GAAL,GAAW;AAAA;AAAA,sCAAUD,WAAV,EAAX;AACA;AAAA;AAAA,sCAAUE,MAAV,CAAiB,cAAjB,EAAiC,KAAKZ,IAAtC,EAA4C,KAAKa,UAAjD,EAA6D,IAA7D;AACH;;AAEwB,eAAXH,WAAW,GAAG;AACxB,cAAI,CAACZ,OAAO,CAACgB,GAAb,EAAkB;AAAEhB,YAAAA,OAAO,CAACgB,GAAR,GAAc,IAAIhB,OAAJ,CAAY,SAAZ,CAAd;AAAuC;;AAC3D,iBAAOA,OAAO,CAACgB,GAAf;AACH,SA1BkC,CA4BnC;;;AACOC,QAAAA,YAAY,GAAG;AAAE,iBAAO,KAAKX,UAAZ;AAAyB;;AAG1CY,QAAAA,WAAW,CAACC,EAAD,EAAa;AAAE;AAC7B,cAAI,CAAC,KAAKV,QAAL,CAAcW,GAAd,CAAkBD,EAAlB,CAAL,EAA4B;AAAE,mBAAO,IAAP;AAAc;;AAC5C,iBAAO,KAAKV,QAAL,CAAcY,GAAd,CAAkBF,EAAlB,CAAP;AACH;;AAEMG,QAAAA,WAAW,CAACH,EAAD,EAAaI,MAAb,EAA2BC,QAA3B,EAA6CC,YAA7C,EAAkEC,GAAlE,EAA8E;AAC5F,cAAItB,IAAI,GAAG,KAAKc,WAAL,CAAiBC,EAAjB,CAAX;;AACA,cAAI,CAAC,KAAKN,GAAV,EAAe;AAAE,iBAAKA,GAAL,GAAW;AAAA;AAAA,wCAAUD,WAAV,EAAX;AAAqC;;AACtD,cAAIR,IAAI,IAAI,KAAKO,MAAjB,EAAyB;AACrB,gBAAIgB,IAAI,GAAG,KAAKd,GAAL,CAASe,SAAT,CAAmBL,MAAnB,EAA2B,MAA3B,EAAmCG,GAAnC,CAAX;;AACA,gBAAI,CAACC,IAAL,EAAW;AAAE;AAAA;AAAA,0CAAUE,OAAV,CAAkB,SAAlB,EAA6B,yBAA7B;AAAyD;AAAS;;AAC/E,gBAAIC,IAAI,GAAGH,IAAI,CAACI,YAAL;AAAA;AAAA,6BAAX;AACAD,YAAAA,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEE,IAAN,CAAW5B,IAAX,EAAiBoB,QAAjB,EAA2BC,YAA3B;AACA,mBAAOE,IAAP;AACH;;AACD;AAAA;AAAA,sCAAUE,OAAV,CAAkB,SAAlB,EAA6B,4BAA7B;AACA,iBAAO,IAAP;AACH;;AAEOd,QAAAA,UAAU,CAACI,EAAD,EAAac,GAAb,EAA0BC,iBAA1B,EAAmDC,QAAnD,EAAuE;AACrF;AACA;AACAA,UAAAA,QAAQ,CAAC,IAAD,CAAR,CAHqF,CAGrE;AAChB;AACH;;AAxDkC,O,kCAEE,I","sourcesContent":["import { _decorator, Component, Node, Vec3 } from 'cc';\r\nimport { Configure } from '../Tools/Configure';\r\nimport { Generator } from '../Tools/Generator';\r\nimport { ImgMgr } from '../Tools/ImgMgr';\r\nimport { Subscribe } from '../Tools/Subscribe';\r\nimport { Item } from './Item';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ItemMgr')\r\nexport class ItemMgr extends Component {\r\n\r\n    private static ist: ItemMgr | null = null;\r\n    private conf: any;\r\n    private item_types: any[] = [];\r\n    private conf_map: Map<string, any> = new Map();\r\n    private imgMgr: ImgMgr | null = null;\r\n    private gen: Generator | null = null;\r\n\r\n    private constructor(name: string) {\r\n        super(name);\r\n        this.conf = Configure.getConfigure(\"items\");\r\n        if (this.conf) {\r\n            this.item_types = this.conf[\"types\"];\r\n            this.conf[\"items\"].forEach((item: any) => {\r\n                this.conf_map.set(item[\"id\"], item);\r\n            });\r\n        }\r\n        this.imgMgr = ImgMgr.getInstance();\r\n        this.gen = Generator.getInstance();\r\n        Subscribe.listen(\"try use item\", this.name, this.tryUseItem, this);\r\n    }\r\n\r\n    public static getInstance() {\r\n        if (!ItemMgr.ist) { ItemMgr.ist = new ItemMgr(\"ItemMgr\"); }\r\n        return ItemMgr.ist;\r\n    }\r\n\r\n    // 获取物品类别\r\n    public getItemTypes() { return this.item_types; }\r\n\r\n\r\n    public getItemConf(id: string) { // 获取物品信息\r\n        if (!this.conf_map.has(id)) { return null; }\r\n        return this.conf_map.get(id);\r\n    }\r\n\r\n    public getItemNode(id: string, parent: Node, item_num: number, browser_root?: Node, pos?: Vec3) {\r\n        let conf = this.getItemConf(id);\r\n        if (!this.gen) { this.gen = Generator.getInstance(); }\r\n        if (conf && this.imgMgr) {\r\n            let node = this.gen.generator(parent, \"Item\", pos);\r\n            if (!node) { Subscribe.trigger(\"log err\", \"Can't find prefab: Item\"); return; }\r\n            let ctrl = node.getComponent(Item);\r\n            ctrl?.init(conf, item_num, browser_root);\r\n            return node;\r\n        }\r\n        Subscribe.trigger(\"log err\", \"ItemMgr initalized failed!\");\r\n        return null;\r\n    }\r\n\r\n    private tryUseItem(id: string, num: number, item_browser_root: Node, callback: Function) {\r\n        // root 是用来放提示框的\r\n        // ##################\r\n        callback(true); // 后续需要加上使用物品的提示，以及若不能使用物品的提示\r\n        // ##################\r\n    }\r\n}"]}