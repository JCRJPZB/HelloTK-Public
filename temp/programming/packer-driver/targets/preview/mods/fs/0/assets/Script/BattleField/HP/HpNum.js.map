{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/BattleField/HP/HpNum.ts"],"names":["_decorator","Component","find","Label","Camera","Functions","Subscribe","ccclass","property","HpNum","onLoad","lbl","getComponent","trigger","init","hp","target","camp","curHp","string","numToStr","camera","scheduleOnce","UIFllow3DNode","node","changeHp","value","rest","getCamp"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,M,OAAAA,M;;AAC1CC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;uBAGjBS,K,WADZF,OAAO,CAAC,OAAD,C,yBAAR,MACaE,KADb,SAC2BR,SAD3B,CACqC;AAAA;AAAA;;AAAA,uCAEZ,IAAIE,KAAJ,EAFY;;AAAA,yCAGT,CAHS;;AAAA,wCAIV,EAJU;AAAA;;AAIN;AAE3BO,QAAAA,MAAM,GAAG;AACL,cAAIC,GAAG,GAAG,KAAKC,YAAL,CAAkBT,KAAlB,CAAV;;AACA,cAAI,CAACQ,GAAL,EAAU;AAAE;AAAA;AAAA,wCAAUE,OAAV,CAAkB,WAAlB,EAA+B,8CAA/B;AAAgF;AAAS;;AACrG,eAAKF,GAAL,GAAWA,GAAX;AACH;;AAEDG,QAAAA,IAAI,CAACC,EAAD,EAAaC,MAAb,EAA2BC,IAA3B,EAAyC;AAAA;;AAAE;AAC3C,cAAI,CAAC,KAAKN,GAAV,EAAe;AAAE;AAAA;AAAA,wCAAUE,OAAV,CAAkB,SAAlB,EAA6B,2BAA7B;AAA2D;AAAS;;AACrF,eAAKK,KAAL,GAAaH,EAAb;AACA,eAAKJ,GAAL,CAASQ,MAAT,GAAkB;AAAA;AAAA,sCAAUC,QAAV,CAAmB,KAAKF,KAAxB,CAAlB,CAHyC,CAGS;;AAClD,eAAKD,IAAL,GAAYA,IAAZ;AACA,cAAII,MAAM,YAAGnB,IAAI,CAAC,cAAD,CAAP,0CAAG,MAAsBU,YAAtB,CAAmCR,MAAnC,CAAb,CALyC,CAKgB;;AACzD,eAAKkB,YAAL,CAAkB,MAAM;AACpB,gBAAI,CAACD,MAAL,EAAa;AAAE;AAAA;AAAA,0CAAUR,OAAV,CAAkB,SAAlB,EAA6B,oBAA7B;AAAoD;AAAS;;AAC5E;AAAA;AAAA,wCAAUU,aAAV,CAAwB,KAAKC,IAA7B,EAAmCH,MAAnC,EAA2CL,MAA3C,EAFoB,CAEgC;AACvD,WAHD,EAGG,GAHH;AAIH;;AAEDS,QAAAA,QAAQ,CAACC,KAAD,EAAgB;AAAE;AACtB,cAAIC,IAAI,GAAG,KAAKT,KAAL,GAAaQ,KAAxB;AACA,eAAKR,KAAL,GAAaS,IAAI,GAAG,CAAP,GAAWA,IAAX,GAAkB,CAA/B;AACA,eAAKhB,GAAL,CAASQ,MAAT,GAAkB;AAAA;AAAA,sCAAUC,QAAV,CAAmB,KAAKF,KAAxB,CAAlB;AACA,iBAAOS,IAAP;AACH,SA7BgC,CA+BjC;;;AACAC,QAAAA,OAAO,GAAG;AAAE,iBAAO,KAAKX,IAAZ;AAAmB;;AAhCE,O","sourcesContent":["import { _decorator, Component, Node, find, Label, Camera } from 'cc';\r\nimport { Functions } from '../../Tools/Functions';\r\nimport { Subscribe } from '../../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HpNum')\r\nexport class HpNum extends Component {\r\n    // private soliders: Node[] = [];\r\n    private lbl: Label = new Label(); // 进度条\r\n    private curHp: number = 0; // 当前血量\r\n    private camp: string = \"\"; // 阵营\r\n\r\n    onLoad() {\r\n        let lbl = this.getComponent(Label);\r\n        if (!lbl) { Subscribe.trigger(\"print err\", \"Node doesn't have component named \\'Label\\'!\"); return; }\r\n        this.lbl = lbl;\r\n    }\r\n\r\n    init(hp: number, target: Node, camp: string) { // 血量，血量跟随的3D物体，阵营\r\n        if (!this.lbl) { Subscribe.trigger(\"log err\", \"Label hasn't initialized!\"); return; }\r\n        this.curHp = hp;\r\n        this.lbl.string = Functions.numToStr(this.curHp); // 数字转字符串并设置\r\n        this.camp = camp;\r\n        let camera = find(\"/Main Camera\")?.getComponent(Camera); // 主摄像机\r\n        this.scheduleOnce(() => {\r\n            if (!camera) { Subscribe.trigger(\"log err\", \"Can't find camera!\"); return; }\r\n            Functions.UIFllow3DNode(this.node, camera, target); // 防止节点位置未初始化，间隔短暂时间后修正一次位置\r\n        }, 0.1);\r\n    }\r\n\r\n    changeHp(value: number) { // 血量变化\r\n        let rest = this.curHp + value;\r\n        this.curHp = rest > 0 ? rest : 0;\r\n        this.lbl.string = Functions.numToStr(this.curHp);\r\n        return rest;\r\n    }\r\n\r\n    // 获取当前血量所属单位的阵营\r\n    getCamp() { return this.camp; }\r\n}\r\n"]}