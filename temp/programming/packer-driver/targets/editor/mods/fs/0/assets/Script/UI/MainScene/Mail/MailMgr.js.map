{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/UI/MainScene/Mail/MailMgr.ts"],"names":["_decorator","Component","Subscribe","ccclass","property","MailMgr","constructor","name","Map","mail_list","getMails","forEach","mail","mail_id_list","push","mail_map","set","listen","readMial","collectAnnex","getInstance","ist","getMailList","addMail","removeMail","id","idx","indexOf","delete","slice","get","updateMail","reciveNewMail","test_data_mail_list"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { Subscribe } from '../../../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MailMgr')\r\nexport class MailMgr extends Component {\r\n\r\n    private static ist: MailMgr;\r\n\r\n    private mail_list: any[] = [];\r\n    private mail_id_list: string[] = [];\r\n    private mail_map: Map<string, any> = new Map();\r\n\r\n    // ############################################################\r\n    private test_data_mail_list: any[] = [\r\n        {\r\n            \"mail_id\": \"001\",\r\n            \"mail_title\": \"登录奖励\",\r\n            \"sender\": \"官方\",\r\n            \"text_content\": \"领主大人，这是您今日的登录奖励~\",\r\n            \"mail_annex\": [\r\n                { \"item_id\": \"Diamond\", \"num\": 50 },\r\n                { \"item_id\": \"Gold\", \"num\": 100000 },\r\n                { \"item_id\": \"GiftBox\", \"num\": 10 }\r\n            ],\r\n            \"isUnRead\": true,\r\n            \"hasAnnex\": true,\r\n            \"collected\": false\r\n        },\r\n        {\r\n            \"mail_id\": \"002\",\r\n            \"mail_title\": \"维护补偿\",\r\n            \"sender\": \"官方\",\r\n            \"text_content\": \"领主大人，本次服务器维护已结束，发放补偿如下：\",\r\n            \"mail_annex\": [\r\n                { \"item_id\": \"Diamond\", \"num\": 200 },\r\n                { \"item_id\": \"Gold\", \"num\": 100000 },\r\n                { \"item_id\": \"Energy\", \"num\": 50 }\r\n            ],\r\n            \"isUnRead\": true,\r\n            \"hasAnnex\": true,\r\n            \"collected\": false\r\n        }\r\n    ]\r\n    // ############################################################\r\n\r\n    private constructor(name: string) {\r\n        super(name);\r\n        this.mail_list = this.getMails();\r\n        this.mail_list.forEach(mail => {\r\n            this.mail_id_list.push(mail[\"mail_id\"]);\r\n            this.mail_map.set(mail[\"mail_id\"], mail);\r\n        });\r\n        Subscribe.listen(\"read mail\", this.name, this.readMial, this);\r\n        Subscribe.listen(\"collect annex\", this.name, this.collectAnnex, this);\r\n    }\r\n\r\n    public static getInstance() {\r\n        if (!MailMgr.ist) { MailMgr.ist = new MailMgr(\"MailMgr\"); }\r\n        return MailMgr.ist;\r\n    }\r\n\r\n    public getMailList() {\r\n        return this.mail_list;\r\n    }\r\n\r\n    public addMail(mail: any) {\r\n        this.mail_list.push(mail);\r\n        this.mail_id_list.push(mail[\"mail_id\"]);\r\n        this.mail_map.set(mail[\"mail_id\"], mail);\r\n    }\r\n\r\n    public removeMail(id: string) {\r\n        let idx = this.mail_id_list.indexOf(id);\r\n        this.mail_map.delete(id);\r\n        this.mail_list.slice(idx, idx);\r\n        this.mail_id_list.slice(idx, idx);\r\n    }\r\n\r\n    private readMial(id: string) {\r\n        let mail = this.mail_map.get(id);\r\n        if (mail && mail[\"isUnRead\"]) {\r\n            mail[\"isUnRead\"] = false;\r\n            this.updateMail();\r\n        }\r\n    }\r\n\r\n    private collectAnnex(id: string) {\r\n        let mail = this.mail_map.get(id);\r\n        if (mail && mail[\"hasAnnex\"] && !mail[\"collected\"]) {\r\n            mail[\"collected\"] = true;\r\n            this.updateMail();\r\n        }\r\n    }\r\n\r\n    public updateMail() {\r\n        // ################\r\n        // 存储新的玩家邮件状态\r\n        // ################\r\n    }\r\n\r\n    public reciveNewMail(mail: any) {\r\n        if (mail[\"mail_id\"] && mail[\"mail_title\"] && mail[\"sender\"] && mail[\"mail_content\"]) { this.mail_list.push(mail); }\r\n        // ##################################\r\n        // Update mail message?\r\n        // ##################################\r\n    }\r\n\r\n    private getMails() {\r\n        // ##################################\r\n        return this.test_data_mail_list; // #\r\n        // ##################################\r\n    }\r\n}\r\n"]}