{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/BattleField/BattleScene.ts"],"names":["_decorator","Component","Subscribe","HpMgr","ccclass","property","BattleScene","onLoad","getInstance","listen","name","battle_over","scene_name","num","data","load_times","stage_data","trigger","isAbandon","isWin","goal_flags"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AACZC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,K,iBAAAA,K;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;6BAGjBM,W,WADZF,OAAO,CAAC,aAAD,C,yBAAR,MACaE,WADb,SACiCL,SADjC,CAC2C;AAAA;AAAA;;AAAA,8CAEb,IAFa;;AAAA,8CAGV,CAHU;AAAA;;AAKvCM,QAAAA,MAAM,GAAG;AACL;AAAA;AAAA,8BAAMC,WAAN;AACA;AAAA;AAAA,sCAAUC,MAAV,CAAiB,gBAAjB,EAAmC,KAAKC,IAAxC,EAA8C,KAAKC,WAAnD,EAAgE,IAAhE;AACA;AAAA;AAAA,sCAAUF,MAAV,CAAiB,oBAAjB,EAAuC,KAAKC,IAA5C,EAAkD,KAAKC,WAAvD,EAAoE,IAApE;AACA;AAAA;AAAA,sCAAUF,MAAV,CAAiB,kBAAjB,EAAqC,KAAKC,IAA1C,EAAgD,CAACE,UAAD,EAAqBC,GAArB,EAAkCC,IAAlC,KAAgD;AAC5F,gBAAIF,UAAU,KAAK,aAAnB,EAAkC;AAC9B,mBAAKG,UAAL,GAAkBF,GAAlB;AACA,mBAAKG,UAAL,GAAkBF,IAAlB,CAF8B,CAEN;;AACxB;AAAA;AAAA,0CAAUG,OAAV,CAAkB,SAAlB,EAA6B,YAA7B,EAA2C,MAA3C;AACH;AACJ,WAND;AAOA;AAAA;AAAA,sCAAUR,MAAV,CAAiB,qBAAjB,EAAwC,KAAKC,IAA7C,EAAmD,MAAM;AACrD;AAAA;AAAA,wCAAUO,OAAV,CAAkB,gBAAlB,EAAoC,KAAKD,UAAzC;AACH,WAFD;AAGH;;AAEOL,QAAAA,WAAW,CAACO,SAAD,EAAqBC,KAArB,EAAqCC,UAArC,EAA4D;AAC3E;AAAA;AAAA,sCAAUH,OAAV,CAAkB,SAAlB,EAA6B,cAA7B,EAA6C,QAA7C,EAAuD,CAAC,KAAKD,UAAN,EAAkBE,SAAlB,EAA6BC,KAA7B,EAAoCC,UAApC,CAAvD;AACH;;AAvBsC,O","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { Subscribe } from '../Tools/Subscribe';\r\nimport { HpMgr } from './HP/HpMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BattleScene')\r\nexport class BattleScene extends Component {\r\n\r\n    private stage_data: any = null;\r\n    private load_times: number = 0;\r\n\r\n    onLoad() {\r\n        HpMgr.getInstance();\r\n        Subscribe.listen(\"battle decided\", this.name, this.battle_over, this);\r\n        Subscribe.listen(\"battle interrupted\", this.name, this.battle_over, this);\r\n        Subscribe.listen(\"UI manager ready\", this.name, (scene_name: string, num: number, data: any) => {\r\n            if (scene_name === \"BattleField\") {\r\n                this.load_times = num;\r\n                this.stage_data = data; // 关卡数据及配置\r\n                Subscribe.trigger(\"open UI\", \"BattlePage\", \"Page\");\r\n            }\r\n        });\r\n        Subscribe.listen(\"Hp manager is ready\", this.name, () => {\r\n            Subscribe.trigger(\"prepare battle\", this.stage_data);\r\n        });\r\n    }\r\n\r\n    private battle_over(isAbandon: boolean, isWin: boolean, goal_flags: boolean[]) {\r\n        Subscribe.trigger(\"open UI\", \"BattleResult\", \"Window\", [this.stage_data, isAbandon, isWin, goal_flags]);\r\n    }\r\n}\r\n"]}