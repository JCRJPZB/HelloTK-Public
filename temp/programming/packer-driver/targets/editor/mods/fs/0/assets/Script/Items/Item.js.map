{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/Items/Item.ts"],"names":["_decorator","Component","Sprite","Label","Functions","Generator","ImgMgr","ItemBrowser","ccclass","property","Item","onLoad","gen","getInstance","init","conf","item_num","browser_root","data","Number","MAX_SAFE_INTEGER","bg","node","getChildByName","getComponent","sp","num_lbl","imgMgr","bg_spf","getImg","sp_spf","spriteFrame","string","numToStr","on","createBrowser","parent","browser","generator","ctrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,K,OAAAA,K;;AACrCC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,W,iBAAAA,W;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;sBAGjBU,I,WADZF,OAAO,CAAC,MAAD,C,yBAAR,MACaE,IADb,SAC0BT,SAD1B,CACoC;AAAA;AAAA;;AAAA,0CAEA,IAFA;;AAAA,uCAGA,IAHA;;AAAA,sCAKQ,IALR;;AAAA,sCAMQ,IANR;;AAAA,2CAOY,IAPZ;;AAAA,wCASZ;AAChB,uBAAW,EADK;AAEhB,2BAAe,EAFC;AAGhB,kBAAM,EAHU;AAIhB,mBAAO,EAJS;AAKhB,oBAAQ,EALQ;AAMhB,wBAAY,EANI;AAOhB,oBAAQ,EAPQ;AAQhB,sBAAU,IARM;AAShB,2BAAe,KATC;AAUhB,4BAAgB,CAVA;AAWhB,mBAAO;AAXS,WATY;AAAA;;AAuBhCU,QAAAA,MAAM,GAAG;AACL,eAAKC,GAAL,GAAW;AAAA;AAAA,sCAAUC,WAAV,EAAX;AACH;;AAEDC,QAAAA,IAAI,CAACC,IAAD,EAAYC,QAAZ,EAA8BC,YAA9B,EAAmD;AAAA;;AACnD,eAAKC,IAAL,GAAYH,IAAZ,CADmD,CAEnD;;AACA,cAAI,KAAKG,IAAL,CAAU,cAAV,MAA8B,CAAC,CAAnC,EAAsC;AAAE,iBAAKA,IAAL,CAAU,cAAV,IAA4BC,MAAM,CAACC,gBAAnC;AAAsD;;AAE9F,eAAKC,EAAL,4BAAU,KAAKC,IAAL,CAAUC,cAAV,CAAyB,IAAzB,CAAV,0DAAU,sBAAgCC,YAAhC,CAA6CtB,MAA7C,CAAV;AACA,eAAKuB,EAAL,6BAAU,KAAKH,IAAL,CAAUC,cAAV,CAAyB,QAAzB,CAAV,2DAAU,uBAAoCC,YAApC,CAAiDtB,MAAjD,CAAV;AACA,eAAKwB,OAAL,6BAAe,KAAKJ,IAAL,CAAUC,cAAV,CAAyB,KAAzB,CAAf,2DAAe,uBAAiCC,YAAjC,CAA8CrB,KAA9C,CAAf;AAEA,eAAKe,IAAL,CAAU,KAAV,IAAmBF,QAAnB;AACA,eAAKW,MAAL,GAAc;AAAA;AAAA,gCAAOd,WAAP,EAAd;AACA,cAAIe,MAAM,GAAG,KAAKD,MAAL,CAAYE,MAAZ,CAAmB,aAAa,KAAKX,IAAL,CAAU,MAAV,CAAhC,CAAb;AACA,cAAIY,MAAM,GAAG,KAAKH,MAAL,CAAYE,MAAZ,CAAmB,KAAKX,IAAL,CAAU,KAAV,CAAnB,CAAb;;AACA,cAAI,KAAKG,EAAL,IAAW,KAAKI,EAAhB,IAAsB,KAAKC,OAA3B,IAAsCE,MAAtC,IAAgDE,MAApD,EAA4D;AACxD,iBAAKT,EAAL,CAAQU,WAAR,GAAsBH,MAAtB;AACA,iBAAKH,EAAL,CAAQM,WAAR,GAAsBD,MAAtB;AACA,iBAAKJ,OAAL,CAAaM,MAAb,GAAsB;AAAA;AAAA,wCAAUC,QAAV,CAAmB,KAAKf,IAAL,CAAU,KAAV,CAAnB,CAAtB;AACH;;AACD,cAAID,YAAJ,EAAkB;AAAE,iBAAKK,IAAL,CAAUY,EAAV,CAAa,OAAb,EAAsB,MAAM;AAAE,mBAAKC,aAAL,CAAmBlB,YAAnB;AAAmC,aAAjE;AAAqE;AAC5F;;AAEOkB,QAAAA,aAAa,CAACC,MAAD,EAAe;AAChC,cAAI,CAAC,KAAKxB,GAAV,EAAe;AAAE,iBAAKA,GAAL,GAAW;AAAA;AAAA,wCAAUC,WAAV,EAAX;AAAqC;;AACtD,cAAIwB,OAAO,GAAG,KAAKzB,GAAL,CAAS0B,SAAT,CAAmBF,MAAnB,EAA2B,cAA3B,CAAd;;AACA,cAAI,CAACC,OAAL,EAAc;AAAE;AAAS;;AACzB,cAAIE,IAAI,GAAGF,OAAO,CAACb,YAAR;AAAA;AAAA,yCAAX;AACAe,UAAAA,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEzB,IAAN,CAAW,KAAKI,IAAhB;AACH;;AAtD+B,O","sourcesContent":["import { _decorator, Component, Node, Sprite, Label } from 'cc';\r\nimport { Functions } from '../Tools/Functions';\r\nimport { Generator } from '../Tools/Generator';\r\nimport { ImgMgr } from '../Tools/ImgMgr';\r\nimport { ItemBrowser } from './ItemBrowser';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Item')\r\nexport class Item extends Component {\r\n\r\n    private imgMgr: ImgMgr | null = null;\r\n    private gen: Generator | null = null;\r\n\r\n    private bg: Sprite | null | undefined = null;\r\n    private sp: Sprite | null | undefined = null;\r\n    private num_lbl: Label | null | undefined = null;\r\n\r\n    private data: any = {\r\n        \"type_id\": \"\",\r\n        \"sub_type_id\": \"\",\r\n        \"id\": \"\",\r\n        \"img\": \"\",\r\n        \"name\": \"\",\r\n        \"describe\": \"\",\r\n        \"rare\": \"\",\r\n        \"access\": null,\r\n        \"able_to_use\": false,\r\n        \"max_num_once\": 0,\r\n        \"num\": 0\r\n    }\r\n\r\n    onLoad() {\r\n        this.gen = Generator.getInstance();\r\n    }\r\n\r\n    init(conf: any, item_num: number, browser_root?: Node) {\r\n        this.data = conf;\r\n        // 无单次使用上限\r\n        if (this.data[\"max_num_once\"] === -1) { this.data[\"max_num_once\"] = Number.MAX_SAFE_INTEGER; }\r\n\r\n        this.bg = this.node.getChildByName(\"Bg\")?.getComponent(Sprite);\r\n        this.sp = this.node.getChildByName(\"Sprite\")?.getComponent(Sprite);\r\n        this.num_lbl = this.node.getChildByName(\"Num\")?.getComponent(Label);\r\n\r\n        this.data[\"num\"] = item_num;\r\n        this.imgMgr = ImgMgr.getInstance();\r\n        let bg_spf = this.imgMgr.getImg(\"Item_Bg_\" + this.data[\"rare\"]);\r\n        let sp_spf = this.imgMgr.getImg(this.data[\"img\"]);\r\n        if (this.bg && this.sp && this.num_lbl && bg_spf && sp_spf) {\r\n            this.bg.spriteFrame = bg_spf;\r\n            this.sp.spriteFrame = sp_spf;\r\n            this.num_lbl.string = Functions.numToStr(this.data[\"num\"]);\r\n        }\r\n        if (browser_root) { this.node.on(\"click\", () => { this.createBrowser(browser_root); }); }\r\n    }\r\n\r\n    private createBrowser(parent: Node) {\r\n        if (!this.gen) { this.gen = Generator.getInstance(); }\r\n        let browser = this.gen.generator(parent, \"Item_Browser\");\r\n        if (!browser) { return; }\r\n        let ctrl = browser.getComponent(ItemBrowser);\r\n        ctrl?.init(this.data);\r\n    }\r\n}\r\n"]}