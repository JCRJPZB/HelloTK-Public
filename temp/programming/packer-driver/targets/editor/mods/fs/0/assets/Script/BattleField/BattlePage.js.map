{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/BattleField/BattlePage.ts"],"names":["_decorator","tween","Functions","Subscribe","UIBase","ccclass","property","BattlePage","onInit","listen","name","set_hp","changeHp","addClickEvent","trigger","ally_bar","getComp","enemy_bar","ally_lbl","enemy_lbl","hpBar_root","getNode","num","camp","ally_max_hp","ally_cur_hp","progress","enemy_max_hp","enemy_cur_hp","updateHp","val","to","easing","start","string","numToStr"],"mappings":"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","sourcesContent":["import { _decorator, Node, ProgressBar, Label, tween } from 'cc';\r\nimport { Functions } from '../Tools/Functions';\r\nimport { Subscribe } from '../Tools/Subscribe';\r\nimport { UIBase } from '../UI/UIBase';\r\nconst { ccclass, property } = _decorator;\r\n \r\n@ccclass('BattlePage')\r\nexport class BattlePage extends UIBase {\r\n\r\n    private hpBar_root: Node | undefined;\r\n    // private ally_protrait: Sprite | undefined;\r\n    // private enemy_protrait: Sprite | undefined;\r\n    private ally_bar: ProgressBar | undefined;\r\n    private enemy_bar: ProgressBar | undefined;\r\n    private ally_lbl: Label | undefined;\r\n    private enemy_lbl: Label | undefined;\r\n\r\n    private ally_max_hp: number = 0;\r\n    private ally_cur_hp: number = 0;\r\n    private enemy_max_hp: number = 0;\r\n    private enemy_cur_hp: number = 0;\r\n\r\n    protected onInit() {\r\n        Subscribe.listen(\"battle set total hp\", this.name, this.set_hp, this);\r\n        Subscribe.listen(\"battle change total hp\", this.name, this.changeHp, this);\r\n        this.addClickEvent(\"PauseBtn\", () => {\r\n            Subscribe.trigger(\"open UI\", \"BattlePauseMenu\", \"Window\");\r\n        });\r\n        // this.ally_protrait = this.getComp(\"AllyProtrait\", \"Sprite\");\r\n        // this.enemy_protrait = this.getComp(\"EnemyProtrait\", \"Sprite\");\r\n        this.ally_bar = this.getComp(\"Ally\", \"ProgressBar\");\r\n        this.enemy_bar = this.getComp(\"Enemy\", \"ProgressBar\");\r\n        this.ally_lbl = this.getComp(\"AllyLabel\", \"Label\");\r\n        this.enemy_lbl = this.getComp(\"EnemyLabel\", \"Label\");\r\n        this.hpBar_root = this.getNode(\"HpBars\");\r\n        if (!this.hpBar_root) {\r\n            Subscribe.trigger(\"log err\", \"Can't find hp bar root\");\r\n        } else {\r\n            Subscribe.trigger(\"set hp bar root\", this.hpBar_root);\r\n        }\r\n    }\r\n\r\n    private set_hp(num: number, camp: string) { // 初始化血量\r\n        if (camp === \"ally\") {\r\n            this.ally_max_hp = this.ally_cur_hp = num;\r\n            if (this.ally_bar) { this.ally_bar.progress = 1; }\r\n        } else if (camp === \"enemy\") {\r\n            this.enemy_max_hp = this.enemy_cur_hp = num;\r\n            if (this.enemy_bar) { this.enemy_bar.progress = 1; }\r\n        }\r\n        this.updateHp();\r\n    }\r\n\r\n    private changeHp(val: number, camp: string) {\r\n        if (camp === \"ally\") {\r\n            this.ally_cur_hp += val;\r\n            if (this.ally_bar) {\r\n                tween(this.ally_bar) // 缓动执行血量变化\r\n                    .to(0.2, { progress: this.ally_cur_hp / this.ally_max_hp }, { easing: \"sineInOut\" })\r\n                    .start();\r\n            }\r\n        } else if (camp === \"enemy\") {\r\n            this.enemy_cur_hp += val;\r\n            if (this.enemy_bar) {\r\n                tween(this.enemy_bar)\r\n                    .to(0.2, { progress: this.enemy_cur_hp / this.enemy_max_hp }, { easing: \"sineInOut\" })\r\n                    .start();\r\n            }\r\n        }\r\n        this.updateHp();\r\n    }\r\n\r\n    private updateHp() { // 更新血量\r\n        if (!this.ally_lbl || !this.enemy_lbl) { return; }\r\n        this.ally_lbl.string = Functions.numToStr(this.ally_cur_hp) + \" / \" + Functions.numToStr(this.ally_max_hp);\r\n        this.enemy_lbl.string = Functions.numToStr(this.enemy_cur_hp) + \" / \" + Functions.numToStr(this.enemy_max_hp);\r\n    }\r\n}\r\n"]}