{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/Heros/HerosMgr.ts"],"names":["_decorator","Component","Configure","Subscribe","ccclass","property","HerosMgr","constructor","name","Map","settings","getConfigure","common","i","length","hero_conf","set","data","getTroops","forEach","hero","hero_data","hero_list","push","listen","troop_conf","troop","getInstance","instance","getHeroList","getHeroConfById","id","has","get","getHeroDataById","updateHeroData"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { Configure } from '../Tools/Configure';\r\nimport { Subscribe } from '../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HerosMgr')\r\nexport class HerosMgr extends Component {\r\n\r\n    private static instance: HerosMgr;\r\n\r\n    private common: any;\r\n    private hero_conf: Map<string, any> = new Map();\r\n    private hero_data: Map<string, any> = new Map();\r\n    private hero_list: string[] = [];\r\n\r\n    // ##################################\r\n    private troop: any = { // 武将配置\r\n        \"heros\": [\r\n            {\r\n                \"id\": \"CaoCao_ally\",\r\n                \"name\": \"曹操\",\r\n                \"hero_id\": \"CaoCao\",\r\n                \"prefab\": \"General_002\",\r\n                \"level\": 60,\r\n                \"hp\": 1800,\r\n                \"atk\": 6000,\r\n                \"def\": 80,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Cavalry_Lv1\",\r\n                \"is_sp\": false,\r\n                \"is_select\": true,\r\n                \"idx\": 0\r\n            },\r\n            {\r\n                \"id\": \"LiuBei_ally\",\r\n                \"name\": \"刘备\",\r\n                \"hero_id\": \"LiuBei\",\r\n                \"prefab\": \"General_002\",\r\n                \"level\": 60,\r\n                \"hp\": 1200,\r\n                \"atk\": 8000,\r\n                \"def\": 50,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Archer_Lv1\",\r\n                \"is_sp\": false,\r\n                \"is_select\": true,\r\n                \"idx\": 1\r\n            },\r\n            {\r\n                \"id\": \"SunQuan_ally\",\r\n                \"name\": \"孙权\",\r\n                \"hero_id\": \"SunQuan\",\r\n                \"prefab\": \"General_002\",\r\n                \"level\": 60,\r\n                \"hp\": 2400,\r\n                \"atk\": 5500,\r\n                \"def\": 100,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Infantry_Lv1\",\r\n                \"is_sp\": false,\r\n                \"is_select\": true,\r\n                \"idx\": 2\r\n            },\r\n            {\r\n                \"id\": \"LvBu_ally\",\r\n                \"hero_id\": \"LvBu\",\r\n                \"name\": \"吕布\",\r\n                \"prefab\": \"General_001\",\r\n                \"level\": 60,\r\n                \"hp\": 2800,\r\n                \"atk\": 5500,\r\n                \"def\": 100,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Infantry_Lv1\",\r\n                \"is_sp\": true,\r\n                \"is_select\": true,\r\n                \"idx\": 3\r\n            },\r\n            {\r\n                \"id\": \"ZhugeLiang_ally\",\r\n                \"name\": \"诸葛亮\",\r\n                \"hero_id\": \"ZhugeLiang\",\r\n                \"prefab\": \"General_001\",\r\n                \"level\": 60,\r\n                \"hp\": 1500,\r\n                \"atk\": 7000,\r\n                \"def\": 80,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Cavalry_Lv1\",\r\n                \"is_sp\": false,\r\n                \"is_select\": true,\r\n                \"idx\": 4\r\n            },\r\n            {\r\n                \"id\": \"ZhouYu_ally\",\r\n                \"name\": \"周瑜\",\r\n                \"hero_id\": \"ZhouYu\",\r\n                \"prefab\": \"General_001\",\r\n                \"level\": 60,\r\n                \"hp\": 1500,\r\n                \"atk\": 7000,\r\n                \"def\": 80,\r\n                \"atkEff\": \"default_atk_particle\",\r\n                \"hitEff\": \"default_hit_particle\",\r\n                \"skill_name\": \"default\",\r\n                \"skillEff\": \"default_skill_particle\",\r\n                \"arms\": \"Cavalry_Lv1\",\r\n                \"is_sp\": false,\r\n                \"is_select\": false,\r\n                \"idx\": 5\r\n            }\r\n        ],\r\n        \"formation\": { // 阵型\r\n            \"id\": \"snake\",\r\n            \"name\": \"长蛇阵\",\r\n            \"pos_idxs\": [0, 1, 4, 5, 8],\r\n            \"introduce\": \"增加部队普通攻击能力\",\r\n            \"ids_idxs\": [\r\n                { \"id\": \"CaoCao_ally\", \"idx\": 0 },\r\n                { \"id\": \"LiuBei_ally\", \"idx\": 1 },\r\n                { \"id\": \"SunQuan_ally\", \"idx\": 2 },\r\n                { \"id\": \"LvBu_ally\", \"idx\": 3 },\r\n                { \"id\": \"ZhugeLiang_ally\", \"idx\": 4 }\r\n            ]\r\n        }\r\n    };\r\n    // ##################################\r\n\r\n    private constructor(name: string) {\r\n        super(name);\r\n        let settings = Configure.getConfigure(\"hero\");\r\n        this.common = settings[\"common\"];\r\n        for (let i = 0; i < settings[\"hero\"].length; i++) {\r\n            this.hero_conf.set(settings[\"hero\"][i][\"id\"], settings[\"hero\"][i]);\r\n        }\r\n        // #############################\r\n        let data = this.getTroops();// # 仍需修改，配合FormationMgr中的内容对应修改\r\n        // #############################\r\n        data[\"heros\"].forEach((hero: any) => {\r\n            this.hero_data.set(hero[\"id\"], hero);\r\n            this.hero_list.push(hero[\"id\"]);\r\n        });\r\n        Subscribe.listen(\"update troop\", this.name, (troop_conf: any) => { this.troop = troop_conf; });\r\n    }\r\n\r\n    public static getInstance(): HerosMgr {\r\n        if (!HerosMgr.instance) {\r\n            HerosMgr.instance = new HerosMgr(\"HerosMgr\");\r\n        }\r\n        return HerosMgr.instance;\r\n    }\r\n\r\n    public getTroops() {\r\n        // #######################\r\n        return this.troop;\r\n        // #######################\r\n    }\r\n\r\n    public getHeroList() { return this.hero_list; }\r\n\r\n    public getHeroConfById(id: string) {\r\n        if (!this.hero_conf.has(id)) { return null; }\r\n        return this.hero_conf.get(id);\r\n    }\r\n\r\n    public getHeroDataById(id: string) {\r\n        if (!this.hero_data.has(id)) { return null; }\r\n        return this.hero_data.get(id);\r\n    }\r\n\r\n    public updateHeroData(data: any) {\r\n        if (!this.hero_data.has(data[\"id\"])) { return; }\r\n        this.hero_data.set(data[\"id\"], data);\r\n    }\r\n}\r\n"]}