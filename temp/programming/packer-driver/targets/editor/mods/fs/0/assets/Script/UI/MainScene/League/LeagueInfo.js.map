{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/UI/MainScene/League/LeagueInfo.ts"],"names":["_decorator","PlayerMgr","ImgMgr","Subscribe","UIBase","LeagueMgr","ccclass","property","LeagueInfo","onInit","addBtnEvent","listen","name","refreshInfo","leagueMgr","getInstance","playerMgr","league_name","getComp","lord","land","numOfMember","league_flag","describe_box","describe_lbl","node","on","changeDescribe","onOpen","trigger","getPlayerInfo","pid","lord_pid","active","onClose","league_id","info","getLeagueInfoById","string","num_of_member","spf","getImg","spriteFrame","box","addClickEvent","shop","tasks","battle","member","contribution","leaveLeague","console","log"],"mappings":"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","sourcesContent":["import { _decorator, Node, Label, Sprite, EditBox } from 'cc';\r\nimport { PlayerMgr } from '../../../Player/PlayerMgr';\r\nimport { ImgMgr } from '../../../Tools/ImgMgr';\r\nimport { Subscribe } from '../../../Tools/Subscribe';\r\nimport { UIBase } from '../../UIBase';\r\nimport { LeagueMgr } from './LeagueMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('LeagueInfo')\r\nexport class LeagueInfo extends UIBase {\r\n\r\n    private leagueMgr: LeagueMgr | null = null;\r\n    private playerMgr: PlayerMgr | null = null;\r\n\r\n    private league_id: string = \"\";\r\n\r\n    private league_name: Label | null | undefined = null;\r\n    private lord: Label | null | undefined = null;\r\n    private lord_pid: string = \"\";\r\n    private land: Label | null | undefined = null;\r\n    private numOfMember: Label | null | undefined = null;\r\n    private league_flag: Sprite | null | undefined = null;\r\n    private describe_box: EditBox | null | undefined = null;\r\n    private describe_lbl: Label | null | undefined = null;\r\n\r\n    protected onInit() {\r\n        this.addBtnEvent();\r\n        \r\n        Subscribe.listen(\"refresh league info\", this.name, this.refreshInfo, this);\r\n\r\n        this.leagueMgr = LeagueMgr.getInstance();\r\n        this.playerMgr = PlayerMgr.getInstance();\r\n        this.league_name = this.getComp(\"Name\", \"Label\");\r\n        this.lord = this.getComp(\"Lord\", \"Label\");\r\n        this.land = this.getComp(\"Land\", \"Label\");\r\n        this.numOfMember = this.getComp(\"NumOfMember\", \"Label\");\r\n        this.league_flag = this.getComp(\"Detail_Flag\", \"Sprite\");\r\n        this.describe_box = this.getComp(\"Describe_Editor\", \"EditBox\");\r\n        this.describe_lbl = this.getComp(\"Describe_Label\", \"Label\");\r\n\r\n        this.describe_box?.node.on(\"editing-did-ended\", this.changeDescribe, this);\r\n    }\r\n\r\n    protected onOpen() {\r\n        if (!this.playerMgr) {\r\n            this.playerMgr = PlayerMgr.getInstance();\r\n        }\r\n        Subscribe.trigger(\"open UI\", \"DynamicList\", \"Window\", this.playerMgr.getPlayerInfo(\"league_id\"));\r\n        this.refreshInfo(this.playerMgr.getPlayerInfo(\"league_id\"));\r\n        let pid = this.playerMgr.getPlayerInfo(\"pid\");\r\n        if (pid === this.lord_pid && this.describe_lbl && this.describe_box) {\r\n            this.describe_box.node.active = true;\r\n            this.describe_lbl.node.active = false;\r\n        }\r\n    }\r\n\r\n    protected onClose() {\r\n        Subscribe.trigger(\"close UI\", \"DynamicList\", \"Window\");\r\n    }\r\n\r\n    private refreshInfo(league_id: string) {\r\n        if (!this.leagueMgr) {\r\n            this.leagueMgr = LeagueMgr.getInstance();\r\n        }\r\n        let info = this.leagueMgr.getLeagueInfoById(league_id);\r\n\r\n        this.league_id = league_id;\r\n        if (this.league_name && info[\"league_name\"]) { this.league_name.string = info[\"league_name\"]; }\r\n        if (this.lord && info[\"lord_name\"]) { this.lord.string = info[\"lord_name\"]; }\r\n        this.lord_pid = info[\"lord_pid\"];\r\n        if (this.land && info[\"land\"]) { this.land.string = info[\"land\"]; }\r\n        if (this.numOfMember && info[\"num_of_member\"] && info[\"max_member\"]) {\r\n            let num_of_member = info[\"num_of_member\"] + '/' + info[\"max_member\"];\r\n            this.numOfMember.string = num_of_member;\r\n        }\r\n        if (this.league_flag && info[\"flag\"]) {\r\n            let spf = ImgMgr.getInstance().getImg(info[\"flag\"]);\r\n            if (spf) { this.league_flag.spriteFrame = spf; }\r\n        }\r\n        if (this.describe_box && info[\"describe\"]) { this.describe_box.string = info[\"describe\"]; }\r\n        if (this.describe_lbl && info[\"describe\"]) { this.describe_lbl.string = info[\"describe\"]; }\r\n        Subscribe.trigger(\"refresh dynamics\", this.league_id);\r\n    }\r\n\r\n    private changeDescribe(box: EditBox) {\r\n        // ########################\r\n        // 将新的联盟描述上传到服务器\r\n        // ########################\r\n    }\r\n\r\n    private addBtnEvent() {\r\n        this.addClickEvent(\"Shop\", this.shop, this);\r\n        this.addClickEvent(\"Tasks\", this.tasks, this);\r\n        this.addClickEvent(\"Battle\", this.battle, this);\r\n        this.addClickEvent(\"Member\", this.member, this);\r\n        this.addClickEvent(\"Contribution\", this.contribution, this);\r\n        this.addClickEvent(\"Leave\", this.leaveLeague, this);\r\n    }\r\n\r\n    private shop() {\r\n        console.log(\"shop\");\r\n    }\r\n    private tasks() {\r\n        console.log(\"tasks\");\r\n    }\r\n    private battle() {\r\n        console.log(\"battle\");\r\n    }\r\n    private member() {\r\n        console.log(\"member\");\r\n    }\r\n    private contribution() {\r\n        console.log(\"contribution\");\r\n    }\r\n    private leaveLeague() {\r\n        PlayerMgr.getInstance().leaveLeague();\r\n        Subscribe.trigger(\"close UI\", \"LeagueInfo\", \"Window\");\r\n        Subscribe.trigger(\"open UI\", \"LeagueList\", \"Window\");\r\n    }\r\n}\r\n"]}