{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/UI/MainScene/HeroList/HeroList.ts"],"names":["_decorator","HerosMgr","Generator","Subscribe","UIBase","HeroListPortrait","ccclass","property","HeroList","Map","onInit","gen","getInstance","herosMgr","hero_id_list","getHeroList","forEach","id","hero_data","set","getHeroDataById","addClickEvent","trigger","heroList_protrait_root","getNode","curr_hero_name_Lbl","getComp","changePane","targetTexture","onOpen","fillList","curr_panel","onClose","removeAllChildren","node","generator","ctrl","getComponent","init","get","listen","name","changeCurrHero","prefab_name","string","panel_name"],"mappings":"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","sourcesContent":["import { _decorator, Node, Sprite, Label } from 'cc';\r\nimport { HerosMgr } from '../../../Heros/HerosMgr';\r\nimport { Generator } from '../../../Tools/Generator';\r\nimport { Subscribe } from '../../../Tools/Subscribe';\r\nimport { UIBase } from '../../UIBase';\r\nimport { HeroListPortrait } from './HeroListPortrait';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroList')\r\nexport class HeroList extends UIBase {\r\n\r\n    private gen: Generator | null = null;\r\n    private herosMgr: HerosMgr | null = null;\r\n    private hero_id_list: string[] = [];\r\n    private hero_data: Map<string, any> = new Map();\r\n\r\n    private heroList_protrait_root: Node | undefined;\r\n    private curr_hero_name_Lbl: Label | undefined;\r\n\r\n    private curr_panel: string = \"\";\r\n\r\n    // 留待后续版本跟进\r\n    // ######################################\r\n    private story_btn: Node | undefined;\r\n    private story_Node: Node | undefined;\r\n    // private story_bg: Sprite | undefined;\r\n    // ######################################\r\n\r\n    private targetTexture: Sprite | undefined;\r\n\r\n    onInit() {\r\n        this.gen = Generator.getInstance();\r\n        this.herosMgr = HerosMgr.getInstance();\r\n        this.hero_id_list = this.herosMgr.getHeroList();\r\n        this.hero_id_list.forEach(id => { this.hero_data.set(id, this.herosMgr!.getHeroDataById(id)); });\r\n\r\n        this.addClickEvent(\"Return\", () => {\r\n            Subscribe.trigger(\"go back page\");\r\n        }, this);\r\n\r\n        this.heroList_protrait_root = this.getNode(\"List_Content\");\r\n        this.curr_hero_name_Lbl = this.getComp(\"Hero_Name\", \"Label\");\r\n\r\n        this.addClickEvent(\"Info_Btn\", () => { this.changePane(\"HeroInfo\"); });\r\n        this.addClickEvent(\"Equip_Btn\", () => { this.changePane(\"HeroEquip\"); });\r\n        this.addClickEvent(\"Spirit_Btn\", () => { this.changePane(\"HeroSpirit\"); });\r\n\r\n        this.targetTexture = this.getComp(\"ModelUI\", \"Sprite\");\r\n    }\r\n\r\n    onOpen() {\r\n        if (this.targetTexture) {\r\n            Subscribe.trigger(\"set model UI targetTexture\", this.targetTexture);\r\n            Subscribe.trigger(\"show hero model\");\r\n        }\r\n        this.fillList();\r\n        this.curr_panel = \"\";\r\n        this.changePane(\"HeroInfo\");\r\n    }\r\n\r\n    onClose() {\r\n        if (this.curr_panel) {\r\n            Subscribe.trigger(\"close UI\", this.curr_panel, \"Window\");\r\n        }\r\n    }\r\n\r\n    private fillList() {\r\n        this.heroList_protrait_root?.removeAllChildren();\r\n        this.hero_id_list.forEach(id => {\r\n            if (!this.gen) { this.gen = Generator.getInstance(); }\r\n            if (!this.heroList_protrait_root) { return; }\r\n            let node = this.gen.generator(this.heroList_protrait_root, \"HeroList_Portrait\");\r\n            let ctrl = node?.getComponent(HeroListPortrait);\r\n            ctrl?.init(this.hero_data.get(id));\r\n        });\r\n        Subscribe.listen(\"change check hero in list\", this.name, this.changeCurrHero, this);\r\n        Subscribe.trigger(\"change check hero in list\", this.hero_id_list[0]);\r\n    }\r\n\r\n    private changeCurrHero(id: string) {\r\n        let name = this.hero_data.get(id)[\"name\"];\r\n        let prefab_name = this.hero_data.get(id)[\"prefab\"];\r\n        if (this.curr_hero_name_Lbl) { this.curr_hero_name_Lbl.string = name; }\r\n        Subscribe.trigger(\"change curr hero model\", prefab_name);\r\n    }\r\n\r\n    private changePane(panel_name: string) {\r\n        if (this.curr_panel != \"\") {\r\n            Subscribe.trigger(\"close UI\", this.curr_panel, \"Window\");\r\n        }\r\n        Subscribe.trigger(\"open UI\", panel_name, \"Window\");\r\n        this.curr_panel = panel_name;\r\n    }\r\n}\r\n"]}