{"version":3,"sources":["file:///E:/GitHub/HelloTK/assets/Script/UI/MainScene/HeroList/Model_UI.ts"],"names":["_decorator","Component","Camera","RenderTexture","SpriteFrame","Generator","Subscribe","ccclass","property","Model_UI","onLoad","listen","name","t","target","node","active","camera","getChildByName","getComponent","gen","getInstance","show","changeHero","prefab_name","model","destroy","generator","updateUI","renderTexture","reset","width","height","targetTexture","spriteFrame","texture"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAgBC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,W,OAAAA,W;;AAC5DC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;0BAGjBS,Q,WADZF,OAAO,CAAC,UAAD,C,yBAAR,MACaE,QADb,SAC8BR,SAD9B,CACwC;AAAA;AAAA;;AAAA,0CAEQ,IAFR;;AAAA,yCAGP,IAHO;;AAAA,0CAIJ,IAJI;;AAAA,uCAKJ,IALI;AAAA;;AAOpCS,QAAAA,MAAM,GAAG;AAAA;;AACL;AAAA;AAAA,sCAAUC,MAAV,CAAiB,4BAAjB,EAA+C,KAAKC,IAApD,EAA2DC,CAAD,IAAe;AACrE,iBAAKC,MAAL,GAAcD,CAAd;AACH,WAFD;AAGA,eAAKE,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACA,eAAKC,MAAL,4BAAc,KAAKF,IAAL,CAAUG,cAAV,CAAyB,QAAzB,CAAd,0DAAc,sBAAoCC,YAApC,CAAiDjB,MAAjD,CAAd;AACA,eAAKkB,GAAL,GAAW;AAAA;AAAA,sCAAUC,WAAV,EAAX;AACA;AAAA;AAAA,sCAAUV,MAAV,CAAiB,iBAAjB,EAAoC,KAAKC,IAAzC,EAA+C,KAAKU,IAApD,EAA0D,IAA1D;AACA;AAAA;AAAA,sCAAUX,MAAV,CAAiB,wBAAjB,EAA2C,KAAKC,IAAhD,EAAsD,KAAKW,UAA3D,EAAuE,IAAvE;AACH;;AAEOD,QAAAA,IAAI,GAAG;AACX,eAAKP,IAAL,CAAUC,MAAV,GAAmB,IAAnB;AACH;;AAEOO,QAAAA,UAAU,CAACC,WAAD,EAAsB;AACpC,cAAI,KAAKC,KAAT,EAAgB;AAAE,iBAAKA,KAAL,CAAWC,OAAX;AAAsB,iBAAKD,KAAL,GAAa,IAAb;AAAoB;;AAC5D,cAAI,CAAC,KAAKL,GAAV,EAAe;AAAE,iBAAKA,GAAL,GAAW;AAAA;AAAA,wCAAUC,WAAV,EAAX;AAAqC;;AACtD,eAAKI,KAAL,GAAa,KAAKL,GAAL,CAASO,SAAT,CAAmB,KAAKZ,IAAxB,EAA8BS,WAA9B,CAAb;AACA,eAAKI,QAAL;AACH;;AAEOA,QAAAA,QAAQ,GAAG;AACf,cAAI,CAAC,KAAKX,MAAN,IAAgB,CAAC,KAAKH,MAA1B,EAAkC;AAAE;AAAS;;AAC7C,gBAAMe,aAAa,GAAG,IAAI1B,aAAJ,EAAtB;AACA0B,UAAAA,aAAa,CAACC,KAAd,CAAoB;AAChBC,YAAAA,KAAK,EAAE,GADS;AAEhBC,YAAAA,MAAM,EAAE;AAFQ,WAApB;AAKA,eAAKf,MAAL,CAAYgB,aAAZ,GAA4BJ,aAA5B;AACA,gBAAMK,WAAW,GAAG,IAAI9B,WAAJ,EAApB;AACA8B,UAAAA,WAAW,CAACC,OAAZ,GAAsBN,aAAtB;AACA,eAAKf,MAAL,CAAYoB,WAAZ,GAA0BA,WAA1B;AACH;;AAzCmC,O","sourcesContent":["import { _decorator, Component, Node, Camera, Sprite, RenderTexture, SpriteFrame } from 'cc';\r\nimport { Generator } from '../../../Tools/Generator';\r\nimport { Subscribe } from '../../../Tools/Subscribe';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Model_UI')\r\nexport class Model_UI extends Component {\r\n\r\n    private camera: Camera | null | undefined = null;\r\n    private model: Node | null = null;\r\n    private target: Sprite | null = null;\r\n    private gen: Generator | null = null;\r\n\r\n    onLoad() {\r\n        Subscribe.listen(\"set model UI targetTexture\", this.name, (t: Sprite) => {\r\n            this.target = t;\r\n        });\r\n        this.node.active = false;\r\n        this.camera = this.node.getChildByName(\"Camera\")?.getComponent(Camera);\r\n        this.gen = Generator.getInstance();\r\n        Subscribe.listen(\"show hero model\", this.name, this.show, this);\r\n        Subscribe.listen(\"change curr hero model\", this.name, this.changeHero, this);\r\n    }\r\n\r\n    private show() {\r\n        this.node.active = true;\r\n    }\r\n\r\n    private changeHero(prefab_name: string) {\r\n        if (this.model) { this.model.destroy(); this.model = null; }\r\n        if (!this.gen) { this.gen = Generator.getInstance(); }\r\n        this.model = this.gen.generator(this.node, prefab_name);\r\n        this.updateUI();\r\n    }\r\n\r\n    private updateUI() {\r\n        if (!this.camera || !this.target) { return; }\r\n        const renderTexture = new RenderTexture();\r\n        renderTexture.reset({\r\n            width: 600,\r\n            height: 800\r\n        });\r\n\r\n        this.camera.targetTexture = renderTexture;\r\n        const spriteFrame = new SpriteFrame();\r\n        spriteFrame.texture = renderTexture;\r\n        this.target.spriteFrame = spriteFrame;\r\n    }\r\n}\r\n"]}